# React Auth: редирект на /login при обновлении страницы (как не допустить в новых проектах)

## Симптом
- Пользователь залогинен (JWT лежит в `localStorage`)
- При `F5 / refresh` приложение **сразу** перебрасывает на `/login`
- Через секунду могло бы подгрузить пользователя, но редирект уже произошёл

## Причина
`ProtectedRoute` проверяет `isAuthenticated` синхронно на первом рендере.  
На старте стора (`zustand`) `isAuthenticated = false`, а `checkAuth()` (запрос `/auth/me`) выполняется **асинхронно** после первого рендера.

В результате: до завершения `checkAuth()` роут считается незащищённым → редирект на `/login`.

## Правильное решение (рекомендуемый стандарт)

### Требование (для ТЗ)
- **ProtectedRoute не должен редиректить на `/login` до завершения проверки авторизации**.
- Пока авторизация инициализируется, UI показывает **Loading** (или скелетон).

### Реализация (паттерн)
1. Добавить флаг `isAuthInitialized` в auth store.
2. В `checkAuth()` выставлять `isAuthInitialized=true` в конце (в `finally`/в каждой ветке).
3. В `ProtectedRoute`:
   - если `!isAuthInitialized` → показать Loading
   - иначе если `!isAuthenticated` → `<Navigate to="/login" />`

## Критерии приёмки
- При наличии валидного токена в `localStorage`:
  - `F5` на любом защищённом роуте **не** переводит на `/login`
  - сначала показывается Loading, затем открывается защищённая страница
- При отсутствии токена:
  - `F5` на защищённом роуте переводит на `/login` после завершения инициализации (без мигания)


